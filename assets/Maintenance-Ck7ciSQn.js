import{c as M,u as P,a as d,j as e,S as A,i as R,k as $,W as S,B as r,I as k,P as J}from"./index-CY3grNaN.js";import{C as g,c as v,a as K,b as Q}from"./Card-BXQ70ezj.js";import{E as I,T as X,a as Y,b as W,c as T,A as Z}from"./EditMaintenanceDrawer-xIdgYDsN.js";import{S as C}from"./square-pen-DsQTHsOQ.js";import{T as D}from"./trash-2-DvQqmIEp.js";import{P as ee}from"./phone-DsX1Wd0m.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],te=M("arrow-right",se);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],z=M("map-pin",ae);function ne({isOpen:m,onClose:o,workshop:a}){const{cars:h,deleteMaintenanceRecord:l}=P(),[c,u]=d.useState(null),[i,f]=d.useState(!1);if(!a)return null;const p=t=>{u(t),f(!0)},b=t=>{window.confirm("Are you sure you want to delete this maintenance record?")&&l(t)};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{isOpen:m,onClose:o,children:[e.jsxs(R,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),a.name]}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(z,{className:"h-3 w-3"})," ",a.details]})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsx(g,{children:e.jsxs(v,{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",a.totalSpent]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Services"}),e.jsx("p",{className:"text-2xl font-bold",children:a.records.length})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Service History"}),a.records.map(t=>{const j=h.find(N=>N.id===t.carId);return e.jsx(g,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:j?`${j.make} ${j.model} `:"Unknown Car"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.paymentStatus==="Pending"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:t.paymentStatus||"Paid"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:t.date}),t.returnDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("span",{children:t.returnDate})]})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["₹",t.amount]}),t.amountPaid!==void 0&&t.amountPaid<t.amount&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Paid: ₹",t.amountPaid]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>p(t),children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive",onClick:()=>b(t.id),children:e.jsx(D,{className:"h-4 w-4"})}),t.image&&e.jsx(r,{variant:"link",size:"sm",className:"h-auto p-0 text-xs",onClick:()=>{window.open().document.write('<img src="'+t.image+'" style="max-width:100%;"/>')},children:"Receipt"})]})]})]})})},t.id)})]})]})]}),e.jsx(I,{isOpen:i,onClose:()=>f(!1),record:c})]})}function ie({isOpen:m,onClose:o,workshop:a}){const{renameWorkshop:h}=P(),[l,c]=d.useState({name:"",details:"",phoneNumber:""});d.useEffect(()=>{var i;a&&c({name:a.name||"",details:a.details||"",phoneNumber:((i=a.records[0])==null?void 0:i.phoneNumber)||""})},[a]);const u=i=>{i.preventDefault(),a&&(h(a.name,l.name,l.details,l.phoneNumber),o())};return a?e.jsxs(A,{isOpen:m,onClose:o,children:[e.jsx(R,{children:e.jsx($,{children:"Edit Workshop"})}),e.jsx("div",{className:"mt-6",children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Workshop Name"}),e.jsx(k,{value:l.name,onChange:i=>c({...l,name:i.target.value}),required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Changes will apply to ",a.records.length," maintenance records."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Address / Details"}),e.jsx(k,{value:l.details,onChange:i=>c({...l,details:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Phone Number"}),e.jsx(k,{value:l.phoneNumber,onChange:i=>c({...l,phoneNumber:i.target.value}),placeholder:"Optional"})]}),e.jsx(r,{type:"submit",className:"w-full",children:"Update Workshop"})]})})]}):null}function xe(){const{maintenanceRecords:m,cars:o,deleteWorkshop:a,deleteMaintenanceRecord:h}=P(),[l,c]=d.useState(null),[u,i]=d.useState(!1),[f,p]=d.useState(!1),[b,t]=d.useState(null),[j,N]=d.useState(!1),[F,E]=d.useState(!1),[y,q]=d.useState("workshops");if(!m||!o)return e.jsx("div",{className:"p-8",children:"Loading maintenance data..."});const O=m.reduce((s,n)=>(s[n.workshopName]||(s[n.workshopName]={name:n.workshopName,details:n.workshopDetails,totalSpent:0,records:[]}),s[n.workshopName].totalSpent+=n.amount,s[n.workshopName].records.push(n),s),{}),H=s=>{c(s),i(!0)},L=s=>{t(s),N(!0)},U=s=>{c(s),E(!0)},_=s=>{window.confirm(`Are you sure you want to delete "${s}"?
This will permanently delete ALL maintenance history associated with this workshop.`)&&a(s)},V=s=>{window.confirm("Are you sure you want to delete this maintenance record?")&&h(s)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Maintenance & Workshops"}),e.jsxs(r,{onClick:()=>p(!0),children:[e.jsx(J,{className:"mr-2 h-4 w-4"})," Add Maintenance"]})]}),e.jsxs(X,{value:y,onValueChange:q,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 mb-6",children:e.jsxs(Y,{className:"bg-transparent p-0",children:[e.jsx(W,{value:"workshops",className:`rounded-none border-b-2 px-6 py-3 ${y==="workshops"?"border-primary text-primary":"border-transparent"}`,children:"Workshops"}),e.jsx(W,{value:"history",className:`rounded-none border-b-2 px-6 py-3 ${y==="history"?"border-primary text-primary":"border-transparent"}`,children:"Service History"})]})}),e.jsx(T,{value:"workshops",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[Object.values(O).map(s=>{var n;return e.jsxs(g,{className:"flex flex-col",children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),s.name]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>U(s),children:e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive",onClick:()=>_(s.name),children:e.jsx(D,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"})," ",s.details,((n=s.records[0])==null?void 0:n.phoneNumber)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1",children:"•"}),e.jsx(ee,{className:"h-3 w-3"})," ",s.records[0].phoneNumber]})]})]}),e.jsxs(v,{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.totalSpent]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Spent"})]}),e.jsxs("div",{className:"space-y-3 mt-auto",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Recent Service History"}),s.records.slice(0,3).map((x,B)=>{const w=o.find(G=>G.id===x.carId);return e.jsxs("div",{className:"text-sm border-l-2 border-primary pl-3",children:[e.jsx("p",{className:"font-medium",children:w?`${w.make} ${w.model}`:"Unknown Car"}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[x.date," • ",x.description||"No description"]})]},B)}),s.records.length>3&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["+ ",s.records.length-3," more records"]}),e.jsxs(r,{variant:"outline",className:"w-full mt-4",onClick:()=>H(s),children:["View Details ",e.jsx(te,{className:"ml-2 h-4 w-4"})]})]})]})]},s.name)}),Object.keys(O).length===0&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-muted-foreground bg-surface dark:bg-surface-dark rounded-lg border border-dashed",children:[e.jsx(S,{className:"h-12 w-12 mb-4 opacity-20"}),e.jsx("p",{children:"No maintenance records found."}),e.jsx(r,{variant:"link",onClick:()=>p(!0),children:"Add your first maintenance record"})]})]})}),e.jsx(T,{value:"history",children:e.jsxs("div",{className:"space-y-4",children:[m.sort((s,n)=>new Date(n.date)-new Date(s.date)).map(s=>{const n=o.find(x=>x.id===s.carId);return e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-lg",children:s.workshopName}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.paymentStatus==="Pending"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s.paymentStatus||"Paid"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["• ",n?`${n.make} ${n.model}`:"Unknown Car"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description||"No description provided"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:s.date}),s.returnDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("span",{children:s.returnDate})]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.workshopDetails}),s.phoneNumber&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.phoneNumber})]})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-xl",children:["₹",s.amount]}),s.amountPaid!==void 0&&s.amountPaid<s.amount&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Paid: ₹",s.amountPaid]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>L(s),children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive",onClick:()=>V(s.id),children:e.jsx(D,{className:"h-4 w-4"})}),s.image&&e.jsx(r,{variant:"link",size:"sm",className:"h-auto p-0 text-xs",onClick:()=>{window.open().document.write('<img src="'+s.image+'" style="max-width:100%;"/>')},children:"Receipt"})]})]})]})})},s.id)}),m.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No maintenance records found."})]})})]}),e.jsx(ne,{isOpen:u,onClose:()=>i(!1),workshop:l}),e.jsx(Z,{isOpen:f,onClose:()=>p(!1)}),e.jsx(I,{isOpen:j,onClose:()=>N(!1),record:b}),e.jsx(ie,{isOpen:F,onClose:()=>E(!1),workshop:l})]})}export{xe as Maintenance};
