import{e as ae,o as te,a as i,j as e,B as h,F as le,I as n,P as B}from"./index-CY3grNaN.js";import{C as b,a as y,b as w,c as D}from"./Card-BXQ70ezj.js";import{a as ne,b as ie}from"./react-pdf.browser-COupAn_t.js";import{I as $}from"./InvoicePDF-CmNjnU2_.js";import{S as re}from"./save-DUH3ZEo5.js";import{T as G}from"./trash-2-DvQqmIEp.js";function ge(){const U=ae(),C=te(),[q,K]=i.useState({}),[j,Q]=i.useState(null),[v,E]=i.useState(`INV-${Date.now().toString().slice(-6)}`),[S,F]=i.useState(new Date().toISOString().split("T")[0]),[r,g]=i.useState({name:"",phone:"",email:"",address:""}),[d,N]=i.useState([{id:1,model:"",regNo:"",startDate:"",endDate:"",days:0,rate:0,amount:0}]),[m,f]=i.useState([{id:"deposit",description:"Deposit",amount:0}]),[p,O]=i.useState(0),[R,z]=i.useState(0),[I,L]=i.useState("");i.useEffect(()=>{var t;const s=localStorage.getItem("driveway_shop_settings");if(s&&K(JSON.parse(s)),(t=C.state)!=null&&t.invoiceData){const a=C.state.invoiceData;Q(a.id),E(a.invoiceNo),F(a.date),g(a.customerDetails||{name:"",phone:"",email:"",address:""}),N(a.vehicles||[]),f(a.additionalCharges||[]),O(a.discount||0),L(a.notes||""),a.tax&&a.subtotal&&z(Math.round(a.tax/a.subtotal*100))}},[C.state]);const W=()=>{const s=d.reduce((l,u)=>l+(Number(u.amount)||0),0),t=m.reduce((l,u)=>l+(Number(u.amount)||0),0),a=s+t,o=a*R/100,c=a+o-Number(p);return{subtotal:a,tax:o,grandTotal:c}},{subtotal:T,tax:k,grandTotal:P}=W(),x=(s,t,a)=>{N(o=>o.map(c=>{if(c.id!==s)return c;const l={...c,[t]:a};if((t==="days"||t==="rate")&&(l.amount=(Number(l.days)||0)*(Number(l.rate)||0)),(t==="startDate"||t==="endDate")&&l.startDate&&l.endDate){const u=new Date(l.startDate),H=new Date(l.endDate);if(!isNaN(u)&&!isNaN(H)){const J=H-u;if(J>0){const M=J/36e5;let V=Math.floor(M/24);M%24>5&&(V+=1),l.days=V,l.amount=V*(Number(l.rate)||0)}else l.days=0,l.amount=0}}return l}))},A=(s,t,a)=>{f(o=>o.map(c=>c.id===s?{...c,[t]:a}:c))},X=()=>{f([...m,{id:Date.now(),description:"",amount:0}])},Y=s=>{f(m.filter(t=>t.id!==s))},Z=()=>{N([...d,{id:Date.now(),model:"",regNo:"",startDate:"",endDate:"",days:0,rate:0,amount:0}])},ee=s=>{d.length!==1&&N(d.filter(t=>t.id!==s))},se=()=>{const s={id:j||Date.now(),invoiceNo:v,date:S,customerDetails:r,vehicles:d,additionalCharges:m,subtotal:T,tax:k,discount:p,grandTotal:P,notes:I},t=JSON.parse(localStorage.getItem("driveway_invoices")||"[]");if(j){const a=t.map(o=>o.id===j?s:o);localStorage.setItem("driveway_invoices",JSON.stringify(a)),alert("Invoice Updated Successfully!")}else localStorage.setItem("driveway_invoices",JSON.stringify([...t,s])),alert("Invoice Created and Saved!");U("/billing/history")},_={invoiceNo:v,date:S,customerDetails:r,vehicles:d,additionalCharges:m,subtotal:T,tax:k,discount:p,grandTotal:P,notes:I,settings:q};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:j?"Edit Invoice":"New Invoice"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",onClick:se,children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Save Record"]}),e.jsx(ne,{document:e.jsx($,{invoice:_}),fileName:`${v}.pdf`,children:({loading:s})=>e.jsxs(h,{className:"bg-red-600 hover:bg-red-700",disabled:s,children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," ",s?"Preparing...":"Download PDF"]})})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 space-y-6 pb-20",children:[e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(w,{children:"Customer Details"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{placeholder:"Invoice No",value:v,onChange:s=>E(s.target.value)}),e.jsx(n,{type:"date",value:S,onChange:s=>F(s.target.value)})]}),e.jsx(n,{placeholder:"Full Name",value:r.name,onChange:s=>g({...r,name:s.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{placeholder:"Phone",value:r.phone,onChange:s=>g({...r,phone:s.target.value})}),e.jsx(n,{placeholder:"Email",value:r.email,onChange:s=>g({...r,email:s.target.value})})]}),e.jsx(n,{placeholder:"Address",value:r.address,onChange:s=>g({...r,address:s.target.value})})]})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"flex flex-row justify-between items-center",children:[e.jsx(w,{children:"Vehicles / Items"}),e.jsx(h,{size:"sm",variant:"outline",onClick:Z,children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsx(D,{className:"space-y-4",children:d.map((s,t)=>e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/20 relative group",children:[e.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{size:"icon",variant:"ghost",className:"h-6 w-6 text-destructive",onClick:()=>ee(s.id),children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsxs("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:["Item #",t+1]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsx(n,{placeholder:"Vehicle Model",value:s.model,onChange:a=>x(s.id,"model",a.target.value)}),e.jsx(n,{placeholder:"Reg No",value:s.regNo,onChange:a=>x(s.id,"regNo",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Start Time"}),e.jsx(n,{type:"datetime-local",value:s.startDate,onChange:a=>x(s.id,"startDate",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"End Time"}),e.jsx(n,{type:"datetime-local",value:s.endDate,onChange:a=>x(s.id,"endDate",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Rate/Day"}),e.jsx(n,{type:"number",value:s.rate,onChange:a=>x(s.id,"rate",a.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Days"}),e.jsx(n,{type:"number",value:s.days,onChange:a=>x(s.id,"days",a.target.value),className:"bg-background"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Amount"}),e.jsx(n,{type:"number",readOnly:!0,value:s.amount,className:"bg-muted font-bold text-foreground"})]})]})]},s.id))})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"flex flex-row justify-between items-center",children:[e.jsx(w,{children:"Additional Charges"}),e.jsx(h,{size:"sm",variant:"outline",onClick:X,children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsx(D,{className:"space-y-4",children:m.map(s=>e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(n,{placeholder:"Description (e.g. Deposit)",value:s.description,onChange:t=>A(s.id,"description",t.target.value),className:"flex-1"}),e.jsxs("div",{className:"w-32 relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground text-xs",children:"₹"}),e.jsx(n,{type:"number",value:s.amount,onChange:t=>A(s.id,"amount",t.target.value),className:"pl-6"})]}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>Y(s.id),className:"text-destructive",children:e.jsx(G,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(w,{children:"Summary"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",T.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:["Tax Rate % ",e.jsx(n,{type:"number",className:"h-6 w-16 text-right",value:R,onChange:s=>z(Number(s.target.value))})]}),e.jsxs("span",{children:["₹",k.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:["Discount ₹ ",e.jsx(n,{type:"number",className:"h-6 w-20 text-right",value:p,onChange:s=>O(Number(s.target.value))})]}),e.jsxs("span",{className:"text-red-500",children:["-₹",p.toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between items-center font-bold text-lg",children:[e.jsx("span",{children:"Grand Total"}),e.jsxs("span",{className:"text-red-600",children:["₹",P.toLocaleString()]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Notes / Terms"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-md border bg-background px-3 py-2 text-sm",placeholder:"Thank you for your business...",value:I,onChange:s=>L(s.target.value)})]})]})]})]}),e.jsx("div",{className:"hidden lg:block lg:flex-1 bg-zinc-900 rounded-lg overflow-hidden border border-zinc-800 shadow-2xl",children:e.jsx(ie,{width:"100%",height:"100%",className:"w-full h-full",showToolbar:!0,children:e.jsx($,{invoice:_})})})]})]})}export{ge as CreateInvoice};
