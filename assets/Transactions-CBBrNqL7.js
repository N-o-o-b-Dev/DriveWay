import{a as r,u as H,j as e,I as b,B as x}from"./index-BwtqAUt7.js";import{C as J,a as K}from"./Card-aWMVJlsh.js";import{T as I,E as Q,D as V}from"./EditTransactionDrawer-0jkdp8E_.js";import{S as T}from"./square-pen-6zai-Pt3.js";import"./Table-D_po6nZo.js";import"./react-pdf.browser-Bu-Ac-AW.js";import"./lock-B9OlmGNY.js";function se(){const[k,A]=r.useState(null),{transactions:E,cars:C,customers:y,dealers:w,deleteTransaction:$}=H(),[D,u]=r.useState(null),[p,h]=r.useState({isOpen:!1,transactionId:null}),[S,O]=r.useState(""),[g,B]=r.useState("All"),[j,F]=r.useState("All"),[f,z]=r.useState(""),[v,M]=r.useState(""),L=E.filter(t=>{const a=C.find(l=>l.id===t.carId),d=y.find(l=>l.id===t.customerId),n=t.dealerId?w.find(l=>l.id===t.dealerId):null,c=`${a==null?void 0:a.make} ${a==null?void 0:a.model} ${a==null?void 0:a.plateNumber} ${d==null?void 0:d.name} ${(n==null?void 0:n.name)||""}`.toLowerCase().includes(S.toLowerCase()),o=g==="All"||t.status===g,s=(t.payments||[]).reduce((l,N)=>N.type==="Credit"?l+Number(N.amount):l-Number(N.amount),0),q=Math.max(0,(t.total||0)-s)>0?"Pending":"Completed",R=j==="All"||q===j,P=new Date(t.startDate),U=!f||P>=new Date(f),G=!v||P<=new Date(v+"T23:59:59");return c&&o&&R&&U&&G});return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Transactions"}),e.jsxs("div",{className:"flex flex-col gap-4 bg-muted/40 p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx("div",{className:"relative flex-1 w-full",children:e.jsx(b,{placeholder:"Search transactions...",className:"bg-background",value:S,onChange:t=>O(t.target.value)})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("select",{className:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm w-full",value:g,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm w-full",value:j,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"All",children:"All Payments"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"From:"}),e.jsx(b,{type:"date",className:"bg-background w-auto",value:f,onChange:t=>z(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"To:"}),e.jsx(b,{type:"date",className:"bg-background w-auto",value:v,onChange:t=>M(t.target.value)})]})]})]}),e.jsx("div",{className:"grid gap-4",children:L.map(t=>{const a=C.find(s=>s.id===t.carId),d=y.find(s=>s.id===t.customerId),n=t.dealerId?w.find(s=>s.id===t.dealerId):null,i=k===t.id,c=(t.payments||[]).reduce((s,m)=>m.type==="Credit"?s+Number(m.amount):s-Number(m.amount),0),o=Math.max(0,(t.total||0)-c);return e.jsxs(J,{className:`relative group transition-all duration-200 ${i?"ring-2 ring-primary":"hover:bg-muted/50 cursor-pointer"}`,onClick:()=>A(i?null:t.id),children:[e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg",children:[a==null?void 0:a.make," ",a==null?void 0:a.model]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Customer: ",d==null?void 0:d.name]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.startDate," - ",t.endDate]}),t.notes&&e.jsx("p",{className:"text-sm mt-2 text-foreground/90",children:t.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${t.status==="Active"?"bg-green-100 text-green-800 border-green-200":t.status==="Completed"?"bg-blue-100 text-blue-800 border-blue-200":"bg-gray-100 text-gray-800 border-gray-200"}`,children:t.status}),o>0?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200",children:"Pending"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:"Completed"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Amount"}),e.jsxs("p",{className:"font-bold",children:["₹",t.total]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paid Amount"}),e.jsxs("p",{className:"font-medium text-green-600",children:["₹",c]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:`font-bold ${o>0?"text-destructive":"text-muted-foreground"}`,children:["₹",o]})]})]}),i&&e.jsxs("div",{className:"mt-4 pt-4 border-t grid grid-cols-2 gap-4 animate-in slide-in-from-top-2 fade-in duration-200",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dealer"}),e.jsx("p",{className:"font-medium",children:(n==null?void 0:n.name)||"Unknown Dealer"}),(n==null?void 0:n.phone)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start Mileage"}),e.jsx("p",{className:"font-medium",children:t.startMileage||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Car Plate"}),e.jsx("p",{className:"font-medium",children:a==null?void 0:a.plateNumber})]}),e.jsxs("div",{className:"flex gap-2 justify-end items-end h-full",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:s=>{s.stopPropagation(),u(t)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"})," Edit"]}),e.jsxs(x,{variant:"destructive",size:"sm",onClick:s=>{s.stopPropagation(),h({isOpen:!0,transactionId:t.id})},children:[e.jsx(I,{className:"h-4 w-4 mr-2"})," Delete"]})]})]})]}),!i&&e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),u(t)},children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:s=>{s.stopPropagation(),h({isOpen:!0,transactionId:t.id})},children:e.jsx(I,{className:"h-4 w-4"})})]})]},t.id)})}),e.jsx(Q,{isOpen:!!D,onClose:()=>u(null),transaction:D}),e.jsx(V,{isOpen:p.isOpen,onClose:()=>h({isOpen:!1,transactionId:null}),onConfirm:()=>{p.transactionId&&$(p.transactionId)},title:"Delete Transaction",description:"Are you sure you want to delete this transaction? This action cannot be undone."})]})}export{se as Transactions};
