import{u as S,a as h,j as e,S as E,i as T,k as L,I as d,B as g,e as _,P as U,_ as O}from"./index-D4_0fjVP.js";import{C as A,c as P}from"./Card-BWG0HchX.js";import{P as $,C as z}from"./PendingTransactionsDrawer-NdhuKfS_.js";import{D as V,a as Q}from"./Dialog-3oKCW97f.js";import{A as H}from"./arrow-up-right-BfDUGzNw.js";import{S as M}from"./store-CAjmc0pM.js";import{U as B}from"./user-BthQopWf.js";import{S as G}from"./square-pen-D_tJKCPn.js";import{T as J}from"./trash-2-BHx0xHie.js";import"./EditTransactionDrawer-ZWc6XXu1.js";import"./Table-B5MNB_ym.js";import"./react-pdf.browser-Bx2rBD8L.js";import"./lock-BM9cBVlp.js";function K({isOpen:m,onClose:p,customer:n}){const{updateCustomer:y,dealers:w}=S(),[t,c]=h.useState({name:"",email:"",phone:"",address:"",image:"",uniqueId:"",dob:"",dlImage:"",aadhaarFront:"",aadhaarBack:"",dealerId:""});h.useEffect(()=>{n&&c({name:n.name,email:n.email,phone:n.phone,address:n.address||"",image:n.image||"",uniqueId:n.uniqueId||"",dob:n.dob||"",dlImage:n.dlImage||"",aadhaarFront:n.aadhaarFront||"",aadhaarBack:n.aadhaarBack||"",dealerId:n.dealerId||""})},[n]);const u=(a,o)=>{const b=o.target.files[0];if(b){const f=new FileReader;f.onloadend=()=>{c(I=>({...I,[a]:f.result}))},f.readAsDataURL(b)}},C=a=>{a.preventDefault(),y(n.id,t),p()};return e.jsxs(E,{isOpen:m,onClose:p,children:[e.jsx(T,{children:e.jsx(L,{children:"Edit Customer"})}),e.jsx("div",{className:"mt-6 h-[calc(100vh-10rem)] overflow-y-auto pr-4",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx(d,{placeholder:"Name",value:t.name,onChange:a=>c({...t,name:a.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{type:"email",placeholder:"Email",value:t.email,onChange:a=>c({...t,email:a.target.value}),required:!0}),e.jsx(d,{placeholder:"Phone",value:t.phone,onChange:a=>c({...t,phone:a.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{placeholder:"Unique ID (e.g. LIC123)",value:t.uniqueId,onChange:a=>c({...t,uniqueId:a.target.value})}),e.jsx(d,{type:"date",placeholder:"Date of Birth",value:t.dob,onChange:a=>c({...t,dob:a.target.value})})]}),e.jsx(d,{placeholder:"Address",value:t.address,onChange:a=>c({...t,address:a.target.value})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Assigned Dealer (Optional)"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:t.dealerId,onChange:a=>c({...t,dealerId:a.target.value}),children:[e.jsx("option",{value:"",children:"None"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(d,{type:"file",accept:"image/*",onChange:a=>u("image",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"DL Image"}),e.jsx(d,{type:"file",accept:"image/*",onChange:a=>u("dlImage",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Front"}),e.jsx(d,{type:"file",accept:"image/*",onChange:a=>u("aadhaarFront",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Back"}),e.jsx(d,{type:"file",accept:"image/*",onChange:a=>u("aadhaarBack",a),className:"cursor-pointer text-xs"})]})]})]}),t.image&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:t.image,alt:"Preview",className:"w-20 h-20 object-cover rounded-full border-2 border-primary"})}),e.jsx(g,{type:"submit",className:"w-full",children:"Save Changes"})]})})]})}function W({customer:m,onQuickView:p}){return e.jsx(A,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-lg border-l-4 border-l-primary/20 hover:border-l-primary cursor-pointer",onClick:p,children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 overflow-hidden border-2 border-white shadow-sm",children:m.image?e.jsx("img",{src:m.image,alt:m.name,className:"h-full w-full object-cover"}):e.jsx(B,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:m.name}),e.jsx("div",{className:"flex flex-col text-sm text-muted-foreground",children:e.jsx("span",{children:m.phone})})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-muted-foreground",children:e.jsx(z,{className:"h-5 w-5"})})]})})})}function oe(){const{customers:m,addCustomer:p,deleteCustomer:n,transactions:y,dealers:w,cars:t}=S(),c=_(),[u,C]=h.useState(!1),[a,o]=h.useState({name:"",email:"",phone:"",address:"",dob:"",dealerId:"",dlImage:"",aadhaarFront:"",aadhaarBack:""}),[b,f]=h.useState(null),[I,D]=h.useState(null),[l,j]=h.useState(null),k=async(s,x)=>{const v=x.target.files[0];if(v)try{const{compressImage:N}=await O(async()=>{const{compressImage:i}=await import("./imageCompression-n-6HeI31.js");return{compressImage:i}},[]),r=await N(v);o(i=>({...i,[s]:r}))}catch(N){console.error("Image compression failed:",N);const r=new FileReader;r.onloadend=()=>{o(i=>({...i,[s]:r.result}))},r.readAsDataURL(v)}},F=async s=>{if(window.confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{await n(s),(l==null?void 0:l.id)===s&&j(null)}catch(x){alert("Failed to delete customer: "+x.message)}},q=s=>{s.preventDefault();try{p(a),C(!1),o({name:"",email:"",phone:"",address:"",dob:"",dealerId:"",dlImage:"",aadhaarFront:"",aadhaarBack:""})}catch(x){alert(x.message)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsxs(g,{onClick:()=>C(!u),children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Add Customer"]})]}),u&&e.jsx(A,{className:"max-w-2xl",children:e.jsxs(P,{className:"pt-6",children:[e.jsx("div",{className:"text-lg font-semibold mb-4",children:"Add New Customer"}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{placeholder:"Customer Name",value:a.name,onChange:s=>o({...a,name:s.target.value}),required:!0}),e.jsx(d,{type:"email",placeholder:"Email",value:a.email,onChange:s=>o({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{placeholder:"Phone",value:a.phone,onChange:s=>o({...a,phone:s.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium ml-1",children:"Date of Birth"}),e.jsx(d,{type:"date",placeholder:"Date of Birth",value:a.dob,onChange:s=>o({...a,dob:s.target.value})})]}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:a.dealerId,onChange:s=>o({...a,dealerId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Dealer (Optional)"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(d,{placeholder:"Address",value:a.address,onChange:s=>o({...a,address:s.target.value})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(d,{type:"file",accept:"image/*",onChange:s=>k("image",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"DL Image"}),e.jsx(d,{type:"file",accept:"image/*",onChange:s=>k("dlImage",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Front"}),e.jsx(d,{type:"file",accept:"image/*",onChange:s=>k("aadhaarFront",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Back"}),e.jsx(d,{type:"file",accept:"image/*",onChange:s=>k("aadhaarBack",s),className:"cursor-pointer text-xs"})]})]})]}),e.jsx(g,{type:"submit",className:"w-full",children:"Save Customer"})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 items-start",children:m.map(s=>e.jsx(W,{customer:s,onQuickView:()=>j(s)},s.id))}),e.jsx(V,{isOpen:!!l,onClose:()=>j(null),children:l&&(()=>{const s=y.filter(r=>r.customerId===l.id),x=s.filter(r=>r.paymentStatus!=="Paid").reduce((r,i)=>r+Math.max(0,(Number(i.total)||0)-(Number(i.amountPaid)||0)),0),v=[...s].sort((r,i)=>new Date(i.startDate)-new Date(r.startDate)).slice(0,3),N=w.find(r=>r.id===l.dealerId);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-xl mb-1",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.phone}),l.address&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.address}),s.length>0&&e.jsxs("p",{className:"text-xs bg-muted px-2 py-0.5 rounded w-fit mt-2",children:["ID: ",l.uniqueId||"N/A"]})]}),l.image&&e.jsx("div",{className:"h-16 w-16 rounded-full overflow-hidden border shrink-0 ml-4",children:e.jsx("img",{src:l.image,className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg cursor-pointer hover:bg-muted transition-colors border",onClick:()=>{j(null),D(l)},children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Pending Balance"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:`text-xl font-bold ${x>0?"text-destructive":""}`,children:["₹",x.toLocaleString()]}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Total Rentals"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-xl font-bold",children:s.length})})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-muted/20 p-2 rounded",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs("span",{children:["Referred by: ",e.jsx("span",{className:"font-medium text-foreground",children:N.name})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Recent Rentals"}),e.jsx("div",{className:"space-y-3",children:v.length>0?v.map(r=>{const i=t.find(R=>R.id===r.carId);return e.jsxs("div",{className:"flex justify-between items-center text-sm border-b pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i?`${i.make} ${i.model}`:"Unknown Car"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(r.startDate).toLocaleDateString()," • ₹",r.total]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.paymentStatus==="Paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.paymentStatus||"Pending"})]},r.id)}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No recent rentals"})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(g,{className:"flex-1",onClick:()=>{j(null),c("/customers/"+l.id)},children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," View Full Profile"]}),e.jsx(g,{variant:"outline",size:"icon",onClick:()=>{j(null),f(l)},children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(g,{variant:"destructive",size:"icon",onClick:()=>F(l.id),children:e.jsx(J,{className:"h-4 w-4"})})]})]})})()}),e.jsx(K,{isOpen:!!b,onClose:()=>f(null),customer:b}),e.jsx($,{isOpen:!!I,onClose:()=>D(null),entity:I,transactions:y,type:"customer"})]})}export{oe as Customers};
