import{h as q,e as R,u as F,a as x,j as e,B as C,X as U}from"./index-XndSkJVU.js";import{C as c,a as D,b as T,c as d}from"./Card-DrV8Gkt2.js";import{E as z}from"./EditTransactionDrawer-65hQXtmR.js";import{T as H,a as M,b as h,c as l,d as O,e as n}from"./Table-CYTZJTxg.js";import{A as V}from"./arrow-left-Dbp8IS6W.js";import{U as X}from"./user-DWYA4XQh.js";import{M as k}from"./mail-HQVoAdbe.js";import{P as I}from"./phone-CLrv7gGP.js";import{S as _}from"./store-D9gV3F0_.js";import{S as G}from"./square-pen-DM4yOsAJ.js";import"./react-pdf.browser-Dx-saAUZ.js";function ne(){var y;const{id:p}=q(),P=R(),{customers:j,transactions:S,dealers:f,cars:A}=F(),[a,$]=x.useState(null),[g,N]=x.useState(null),[b,u]=x.useState(null);if(x.useEffect(()=>{const s=j.find(t=>t.id===p);s&&$(s)},[p,j]),!a)return e.jsx("div",{className:"p-8",children:"Loading..."});const o=S.filter(s=>s.customerId===a.id),v=o.flatMap(s=>{const t=A.find(i=>i.id===s.carId),r=t?`${t.make} ${t.model}`:"Unknown Car",m=[];return m.push({id:s.id,uniqueId:s.id,date:s.startDate,description:r,type:"Debit",status:s.status,amount:Number(s.total)||0,originalTransaction:s,isRental:!0}),s.payments&&s.payments.length>0?s.payments.forEach(i=>{m.push({id:i.id,uniqueId:i.id,date:i.date,description:`Payment for ${r}`,type:i.type,status:"Paid",amount:Number(i.amount)||0,originalTransaction:s,isRental:!1})}):Number(s.amountPaid)>0&&m.push({id:`${s.id}_payment`,uniqueId:"Legacy",date:s.startDate,description:`Payment for ${r}`,type:"Credit",status:"Paid",amount:Number(s.amountPaid),originalTransaction:s,isRental:!1}),m}).sort((s,t)=>new Date(t.date)-new Date(s.date)),L=o.reduce((s,t)=>s+(Number(t.total)||0),0),B=o.filter(s=>s.paymentStatus!=="Paid").reduce((s,t)=>s+Math.max(0,(Number(t.total)||0)-(Number(t.amountPaid)||0)),0),E=[...new Set(o.map(s=>s.dealerId).filter(s=>s))],w=f.filter(s=>E.includes(s.id));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>P("/customers"),children:e.jsx(V,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 overflow-hidden border-2 border-white shadow-sm ${a.image?"cursor-pointer hover:opacity-80 transition-opacity":""}`,onClick:()=>a.image&&u(a.image),children:a.image?e.jsx("img",{src:a.image,alt:a.name,className:"h-full w-full object-cover"}):e.jsx(X,{className:"h-6 w-6 text-primary"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a.name})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(D,{children:e.jsx(T,{children:"Contact Information"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.phone})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{children:e.jsxs(d,{className:"p-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Spent"}),e.jsxs("h3",{className:"text-2xl font-bold",children:["₹",L.toLocaleString()]})]})}),e.jsx(c,{children:e.jsxs(d,{className:"p-4 pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Amount"}),e.jsxs("h3",{className:"text-2xl font-bold text-destructive",children:["₹",B.toLocaleString()]})]})})]}),e.jsxs(c,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(T,{className:"text-base",children:"Personal Information"})}),e.jsxs(d,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unique ID"}),e.jsx("span",{className:"font-medium",children:a.uniqueId||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date of Birth"}),e.jsx("span",{className:"font-medium",children:a.dob||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Address"}),e.jsx("span",{className:"font-medium max-w-[200px] text-right",children:a.address||"N/A"})]}),a.dealerId&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Assigned Dealer"}),e.jsxs("span",{className:"font-medium flex items-center gap-1 justify-end",children:[e.jsx(_,{className:"h-3 w-3"}),((y=f.find(s=>s.id===a.dealerId))==null?void 0:y.name)||"Unknown"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Documents"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.dlImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.dlImage),children:[e.jsx("img",{src:a.dlImage,alt:"DL",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View DL"})]}),a.aadhaarFront&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.aadhaarFront),children:[e.jsx("img",{src:a.aadhaarFront,alt:"Aadhaar Front",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"Front"})]}),a.aadhaarBack&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.aadhaarBack),children:[e.jsx("img",{src:a.aadhaarBack,alt:"Aadhaar Back",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"Back"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Transaction History"})}),e.jsx("div",{className:"rounded-md border bg-card",children:e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(h,{className:"bg-muted/50",children:[e.jsx(l,{className:"w-[85px] text-xs",children:"Trans ID"}),e.jsx(l,{className:"text-xs",children:"Description"}),e.jsx(l,{className:"w-[100px] text-xs",children:"Status"}),e.jsx(l,{className:"w-[90px] text-xs",children:"Date"}),e.jsx(l,{className:"text-right text-xs",children:"Amount"}),e.jsx(l,{className:"w-[40px]"})]})}),e.jsx(O,{children:v.length>0?v.map((s,t)=>{var r;return e.jsxs(h,{className:"text-xs",children:[e.jsx(n,{className:"font-mono text-[10px] text-muted-foreground align-top py-3",children:s.uniqueId==="Legacy"?"-":s.uniqueId.slice(0,8)}),e.jsxs(n,{className:"align-top py-3 font-medium",children:[s.description,s.isRental&&e.jsx("div",{className:"text-[10px] text-muted-foreground mt-0.5 font-normal",children:(r=s.originalTransaction)!=null&&r.endDate?`Till ${s.originalTransaction.endDate}`:"Active"})]}),e.jsx(n,{className:"align-top py-3",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-medium whitespace-nowrap ${s.type==="Credit"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.type==="Credit"?"Credit":"Debit"})}),e.jsx(n,{className:"align-top py-3",children:new Date(s.date).toLocaleString()}),e.jsxs(n,{className:`text-right font-medium align-top py-3 ${s.type==="Credit"?"text-green-600":""}`,children:[s.type==="Credit"?"+":"-","₹",s.amount.toLocaleString()]}),e.jsx(n,{className:"align-top py-3",children:s.originalTransaction&&e.jsx(C,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>N(s.originalTransaction),children:e.jsx(G,{className:"h-3 w-3"})})})]},`${s.id}-${t}`)}):e.jsx(h,{children:e.jsx(n,{colSpan:6,className:"text-center text-xs text-muted-foreground py-4",children:"No financial records found"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Associated Dealers"}),e.jsx("div",{className:"space-y-3",children:w.length>0?w.map(s=>e.jsx(c,{children:e.jsxs(d,{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-1",children:s.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),s.email]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),s.phone]})]})]})},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No associated dealers."})})]})]})]}),e.jsx(z,{isOpen:!!g,onClose:()=>N(null),transaction:g}),b&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>u(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsx("img",{src:b,alt:"Expanded Profile",className:"max-w-full max-h-[90vh] object-contain rounded-md"}),e.jsx("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors p-2",onClick:s=>{s.stopPropagation(),u(null)},children:e.jsx(U,{size:32})})]})})]})}export{ne as CustomerDetailsPage};
