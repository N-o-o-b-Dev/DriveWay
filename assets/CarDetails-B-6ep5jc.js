import{i as de,f as ce,u as oe,a as r,j as e,B as m,P as me,W as xe,S as ue,k as he,l as pe,I as j,m as je}from"./index-BwtqAUt7.js";import{C as v,b as D,c as k,a as b}from"./Card-aWMVJlsh.js";import{T as fe,a as ge,b as C,c as T,A as ve,E as be}from"./EditMaintenanceDrawer-gWlFMvej.js";import{E as Ne}from"./EditCarDrawer-C0MHBcJP.js";import{T as F,E as ye,D as we}from"./EditTransactionDrawer-0jkdp8E_.js";import{S as I}from"./square-pen-6zai-Pt3.js";import{C as q}from"./clock-DElpx7Wp.js";import"./Table-D_po6nZo.js";import"./react-pdf.browser-Bu-Ac-AW.js";import"./lock-B9OlmGNY.js";function Me(){const{id:f}=de(),z=ce(),{cars:B,transactions:H,customers:S,addTransaction:L,updateCar:W,maintenanceRecords:R,deleteCar:U,deleteTransaction:Y}=oe(),[g,P]=r.useState("overview"),[G,N]=r.useState(!1),[J,O]=r.useState(!1),[K,E]=r.useState(!1),[Q,X]=r.useState(null),[Z,M]=r.useState(!1),[_,ee]=r.useState(null),[se,A]=r.useState(!1),[y,V]=r.useState({isOpen:!1,transactionId:null}),ae=s=>{X(s),M(!0)},te=s=>{V({isOpen:!0,transactionId:s})},ne=()=>{y.transactionId&&Y(y.transactionId)},[t,o]=r.useState({customerId:"",startDate:"",endDate:"",notes:"",paymentStatus:"Pending",dailyRate:"",mileage:"",discount:""}),[x,$]=r.useState({total:0,breakdown:[]}),a=B.find(s=>s.id===f),w=H.filter(s=>s.carId===f&&s.status!=="Cancelled").sort((s,n)=>new Date(n.startDate)-new Date(s.startDate));if(r.useEffect(()=>{a&&o(s=>!s.dailyRate&&!s.mileage&&s.mileage!==0?{...s,dailyRate:a.price,mileage:a.mileage||""}:s)},[a]),r.useEffect(()=>{if(t.startDate&&t.endDate&&a){const s=new Date(t.startDate),n=new Date(t.endDate),c=Math.abs(n-s),i=Math.ceil(c/(1e3*60*60*24));let l=0,d=[];const h=t.dailyRate?parseFloat(t.dailyRate):a.price;if(i>0)if(i>=20&&a.monthlyPrice){const p=a.monthlyPrice/30;l=Math.round(p*i+300),d.push({label:`Long Term Rate (>=20 days) (${i} days @ ₹${Math.round(p)}/day + ₹300)`,amount:l})}else if(i>=10&&a.tenDayPrice){const p=a.tenDayPrice/10;l=Math.round(p*i),d.push({label:`10-Day Rate Applied (${i} days @ ₹${Math.round(p)}/day)`,amount:l})}else l=Math.round(h*i),d.push({label:`Standard Daily Rate (${i} days @ ₹${h}/day)`,amount:l});const u=t.discount?parseFloat(t.discount):0;u>0&&(d.push({label:"Discount",amount:-u}),l=Math.max(0,l-u)),$({total:l,breakdown:d})}else $({total:0,breakdown:[]})},[t.startDate,t.endDate,a,t.dailyRate,t.discount]),!a)return e.jsx("div",{children:"Car not found"});const ie=s=>{s.preventDefault();const n=new Date(t.startDate),c=new Date(t.endDate);if(w.some(d=>{if(d.status==="Cancelled")return!1;const h=new Date(d.startDate),u=new Date(d.endDate);return n>=h&&n<=u||c>=h&&c<=u||n<=h&&c>=u})){alert("This car is already rented for the selected dates!");return}console.log("Mileage check:",t.mileage),t.mileage!==""&&t.mileage!==null&&t.mileage!==void 0&&(console.log("Updating mileage to:",t.mileage),W(a.id,{mileage:parseInt(t.mileage)}));const l=[];t.paymentStatus==="Paid"&&l.push({id:je(),date:new Date().toISOString().split("T")[0],amount:x.total,type:"Credit",medium:"Cash",notes:"Initial Payment"}),L({carId:a.id,customerId:t.customerId,startDate:t.startDate,endDate:t.endDate,total:x.total,status:"Active",paymentStatus:t.paymentStatus,notes:t.notes,breakdown:x.breakdown,dailyRate:t.dailyRate,payments:l,amountPaid:t.paymentStatus==="Paid"?x.total:0,startMileage:t.mileage}),N(!1),o({customerId:"",startDate:"",endDate:"",notes:"",paymentStatus:"Pending",dailyRate:"",mileage:""}),P("rentals")},le=()=>{window.confirm("Are you sure you want to delete this car? This action cannot be undone.")&&(U(a.id),z("/cars"))},re=()=>{if(!a.insuranceValidTo)return null;const s=new Date,c=new Date(a.insuranceValidTo)-s,i=Math.ceil(c/(1e3*60*60*24));return i<=3&&i>=0?e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg mb-6 flex items-center gap-3 text-destructive",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Insurance Expiring Soon!"}),e.jsxs("p",{className:"text-sm",children:["Insurance is valid only for ",i," more day",i!==1?"s":"",". Please renew immediately."]})]})]}):i<0?e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg mb-6 flex items-center gap-3 text-destructive",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Insurance Expired!"}),e.jsxs("p",{className:"text-sm",children:["Insurance expired on ",a.insuranceValidTo,". Do not rent this car until renewed."]})]})]}):null};return e.jsxs("div",{className:"space-y-8 relative",children:[re(),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-4xl font-bold mb-2",children:[a.make," ",a.model]}),e.jsxs("p",{className:"text-xl text-muted-foreground",children:[a.year," • ",a.plateNumber]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-muted-foreground",children:[a.color&&e.jsxs("span",{children:["Color: ",a.color]}),a.fuelType&&e.jsxs("span",{children:["Fuel: ",a.fuelType]}),e.jsxs("span",{children:["Mileage: ",a.mileage," km"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>O(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Edit"]}),e.jsxs(m,{variant:"destructive",onClick:le,children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Delete"]}),e.jsxs(m,{onClick:()=>N(!0),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Rent Car"]})]})]}),e.jsxs(fe,{value:g,onValueChange:P,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 mb-6",children:e.jsxs(ge,{className:"bg-transparent p-0",children:[e.jsx(C,{value:"overview",className:`rounded-none border-b-2 px-6 py-3 ${g==="overview"?"border-primary text-primary":"border-transparent"}`,children:"Overview"}),e.jsx(C,{value:"rentals",className:`rounded-none border-b-2 px-6 py-3 ${g==="rentals"?"border-primary text-primary":"border-transparent"}`,children:"Rentals"}),e.jsx(C,{value:"maintenance",className:`rounded-none border-b-2 px-6 py-3 ${g==="maintenance"?"border-primary text-primary":"border-transparent"}`,children:"Maintenance"})]})}),e.jsx(T,{value:"overview",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"aspect-video w-full overflow-hidden rounded-lg bg-muted",children:a.image?e.jsx("img",{src:a.image,alt:`${a.make} ${a.model}`,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No Image"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.rcImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.rcImage),children:[e.jsx("img",{src:a.rcImage,alt:"RC",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View RC"})]}),a.insuranceImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.insuranceImage),children:[e.jsx("img",{src:a.insuranceImage,alt:"Insurance",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View Insurance"})]}),a.pocImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(a.pocImage),children:[e.jsx("img",{src:a.pocImage,alt:"POC",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View POC"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.status==="Available"?"bg-green-100 text-green-800":a.status==="On Rent"?"bg-blue-100 text-blue-800":a.status==="On Maintenance"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:a.status})}),e.jsxs(v,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(k,{className:"text-base",children:"Vehicle Specifications"})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Mileage"}),e.jsxs("span",{className:"font-medium text-lg",children:[a.mileage," km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Fuel Type"}),e.jsx("span",{className:"font-medium",children:a.fuelType||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Color"}),e.jsx("span",{className:"font-medium",children:a.color||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Year"}),e.jsx("span",{className:"font-medium",children:a.year})]})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),(a.fitnessValidTo||a.taxValidTo||a.insuranceValidTo)&&e.jsxs(v,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(k,{className:"text-base",children:"Validity"})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4 text-sm",children:[a.fitnessValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Fitness"}),e.jsx("span",{className:"font-medium",children:a.fitnessValidTo})]}),a.taxValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Tax"}),e.jsx("span",{className:"font-medium",children:a.taxValidTo})]}),a.insuranceValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Insurance"}),e.jsx("span",{className:"font-medium",children:a.insuranceValidTo})]})]})]}),e.jsxs(v,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(k,{className:"text-base",children:"Pricing"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Daily Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",a.price]})]}),a.tenDayPrice&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"10 Days Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",a.tenDayPrice]})]}),a.monthlyPrice&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",a.monthlyPrice]})]})]})]})]})]})}),e.jsx(T,{value:"rentals",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-2xl font-bold",children:"Rental History"})}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 bg-muted/50 font-medium text-sm",children:[e.jsx("div",{className:"col-span-2",children:"Customer"}),e.jsx("div",{children:"Dates"}),e.jsx("div",{children:"Amount"}),e.jsx("div",{children:"Balance"}),e.jsx("div",{className:"text-right",children:"Actions"})]}),e.jsxs("div",{className:"divide-y",children:[w.map(s=>{const n=S.find(d=>d.id===s.customerId),c=Number(s.total)||0,i=Number(s.amountPaid)||0,l=c-i;return e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 items-center text-sm hover:bg-muted/20 transition-colors",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"font-medium",children:n==null?void 0:n.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n==null?void 0:n.phone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.startDate}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["to ",s.endDate]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["₹",c]}),e.jsx("div",{className:`text-xs ${s.paymentStatus==="Paid"?"text-green-600":"text-orange-600"}`,children:s.paymentStatus})]}),e.jsx("div",{children:e.jsxs("div",{className:`font-medium ${l>0?"text-destructive":"text-green-600"}`,children:["₹",l]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>{ee(s),A(!0)},children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>te(s.id),children:e.jsx(F,{className:"h-4 w-4"})})]})]},s.id)}),w.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No rental history found."})]})]})]})}),e.jsx(T,{value:"maintenance",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Maintenance History"}),e.jsxs(m,{onClick:()=>E(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Add Record"]})]}),e.jsx("div",{className:"grid gap-4",children:R.filter(s=>s.carId===f).length>0?R.filter(s=>s.carId===f).map(s=>e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-bold text-lg",children:s.workshopName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:s.date}),s.returnDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:s.returnDate})]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.workshopDetails})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsxs("p",{className:"font-bold text-xl",children:["₹",s.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ae(s),children:e.jsx(I,{className:"h-4 w-4"})}),s.image&&e.jsx(m,{variant:"link",size:"sm",className:"h-auto p-0 text-xs",onClick:()=>{window.open().document.write('<img src="'+s.image+'" style="max-width:100%;"/>')},children:"Receipt"})]})]})]})})},s.id)):e.jsx("div",{className:"text-center py-12 text-muted-foreground bg-surface rounded-lg",children:"No maintenance records found for this car."})})]})})]}),e.jsx(ve,{isOpen:K,onClose:()=>E(!1),carId:a.id}),e.jsx(be,{isOpen:Z,onClose:()=>M(!1),record:Q}),e.jsxs(ue,{isOpen:G,onClose:()=>N(!1),children:[e.jsx(he,{children:e.jsxs(pe,{children:["Rent ",a.make," ",a.model]})}),e.jsx("div",{className:"mt-6",children:e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Customer"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:t.customerId,onChange:s=>o({...t,customerId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(j,{type:"date",value:t.startDate,onChange:s=>o({...t,startDate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsx(j,{type:"date",value:t.endDate,onChange:s=>o({...t,endDate:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Per Day Amount"}),e.jsx(j,{type:"number",value:t.dailyRate,onChange:s=>o({...t,dailyRate:s.target.value}),placeholder:"Enter daily rate"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Mileage"}),e.jsx(j,{type:"number",value:t.mileage,onChange:s=>o({...t,mileage:s.target.value}),placeholder:"Starting mileage"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Payment Status"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:t.paymentStatus,onChange:s=>o({...t,paymentStatus:s.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Pay on Arrival",children:"Pay on Arrival"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(j,{placeholder:"Additional notes...",value:t.notes,onChange:s=>o({...t,notes:s.target.value})})]}),e.jsxs("div",{className:"bg-surface dark:bg-surface-dark p-4 rounded-lg space-y-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("span",{className:"text-sm font-medium",children:"Price Breakdown"})}),x.breakdown.length>0?e.jsxs("div",{className:"space-y-1",children:[x.breakdown.map((s,n)=>e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:s.label}),e.jsxs("span",{children:["₹",s.amount]})]},n)),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",x.total]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select dates to see price breakdown."})]}),e.jsx(m,{type:"submit",className:"w-full",children:"Confirm Rental"})]})})]}),e.jsx(ye,{isOpen:se,onClose:()=>A(!1),transaction:_}),e.jsx(Ne,{isOpen:J,onClose:()=>O(!1),car:a}),e.jsx(we,{isOpen:y.isOpen,onClose:()=>V({isOpen:!1,transactionId:null}),onConfirm:ne,title:"Delete Rental Record",description:"Are you sure you want to delete this rental record? This action cannot be undone."})]})}export{Me as CarDetails};
