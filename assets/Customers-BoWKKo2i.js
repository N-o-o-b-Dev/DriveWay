import{u as A,a as u,j as e,S as _,k as U,l as O,I as t,B as g,f as $,P as z,_ as V}from"./index-BwtqAUt7.js";import{C as P,a as B}from"./Card-aWMVJlsh.js";import{P as Q,C as H}from"./PendingTransactionsDrawer-CnAxnfnp.js";import{a as M,b as W}from"./EditTransactionDrawer-0jkdp8E_.js";import{A as G}from"./arrow-up-right-DQYGrcTn.js";import{S as J}from"./store-CMaso4OH.js";import{U as F}from"./user-DTuM9DXv.js";import{S as K}from"./square-pen-6zai-Pt3.js";import{T as X}from"./trash-2-BunDUYmv.js";import"./Table-D_po6nZo.js";import"./react-pdf.browser-Bu-Ac-AW.js";import"./lock-B9OlmGNY.js";function Y({isOpen:m,onClose:p,customer:d}){const{updateCustomer:y,dealers:w}=A(),[l,o]=u.useState({name:"",email:"",phone:"",address:"",image:"",uniqueId:"",dob:"",dlImage:"",aadhaarFront:"",aadhaarBack:"",dealerId:""});u.useEffect(()=>{d&&o({name:d.name,email:d.email,phone:d.phone,address:d.address||"",image:d.image||"",uniqueId:d.uniqueId||"",dob:d.dob||"",dlImage:d.dlImage||"",aadhaarFront:d.aadhaarFront||"",aadhaarBack:d.aadhaarBack||"",dealerId:d.dealerId||""})},[d]);const h=(s,c)=>{const b=c.target.files[0];if(b){const f=new FileReader;f.onloadend=()=>{o(I=>({...I,[s]:f.result}))},f.readAsDataURL(b)}},C=s=>{s.preventDefault(),y(d.id,l),p()};return e.jsxs(_,{isOpen:m,onClose:p,children:[e.jsx(U,{children:e.jsx(O,{children:"Edit Customer"})}),e.jsx("div",{className:"mt-6 h-[calc(100vh-10rem)] overflow-y-auto pr-4",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx(t,{placeholder:"Name",value:l.name,onChange:s=>o({...l,name:s.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{type:"email",placeholder:"Email",value:l.email,onChange:s=>o({...l,email:s.target.value}),required:!0}),e.jsx(t,{placeholder:"Phone",value:l.phone,onChange:s=>o({...l,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Unique ID (e.g. LIC123)",value:l.uniqueId,onChange:s=>o({...l,uniqueId:s.target.value})}),e.jsx(t,{type:"date",placeholder:"Date of Birth",value:l.dob,onChange:s=>o({...l,dob:s.target.value})})]}),e.jsx(t,{placeholder:"Address",value:l.address,onChange:s=>o({...l,address:s.target.value})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Assigned Dealer (Optional)"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:l.dealerId,onChange:s=>o({...l,dealerId:s.target.value}),children:[e.jsx("option",{value:"",children:"None"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>h("image",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"DL Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>h("dlImage",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Front"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>h("aadhaarFront",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Back"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>h("aadhaarBack",s),className:"cursor-pointer text-xs"})]})]})]}),l.image&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:l.image,alt:"Preview",className:"w-20 h-20 object-cover rounded-full border-2 border-primary"})}),e.jsx(g,{type:"submit",className:"w-full",children:"Save Changes"})]})})]})}function Z({customer:m,onQuickView:p}){return e.jsx(P,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-lg border-l-4 border-l-primary/20 hover:border-l-primary cursor-pointer",onClick:p,children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 overflow-hidden border-2 border-white shadow-sm",children:m.image?e.jsx("img",{src:m.image,alt:m.name,className:"h-full w-full object-cover"}):e.jsx(F,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:m.name}),e.jsx("div",{className:"flex flex-col text-sm text-muted-foreground",children:e.jsx("span",{children:m.phone})})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-muted-foreground",children:e.jsx(H,{className:"h-5 w-5"})})]})})})}function xe(){const{customers:m,addCustomer:p,deleteCustomer:d,transactions:y,dealers:w,cars:l}=A(),o=$(),[h,C]=u.useState(!1),[s,c]=u.useState({name:"",email:"",phone:"",address:"",dob:"",dealerId:"",dlImage:"",aadhaarFront:"",aadhaarBack:""}),[b,f]=u.useState(null),[I,D]=u.useState(null),[n,j]=u.useState(null),[S,q]=u.useState(""),R=m.filter(a=>(a.name+" "+a.phone+" "+a.email).toLowerCase().includes(S.toLowerCase())),k=async(a,x)=>{const v=x.target.files[0];if(v)try{const{compressImage:N}=await V(async()=>{const{compressImage:i}=await import("./imageCompression-n-6HeI31.js");return{compressImage:i}},[]),r=await N(v);c(i=>({...i,[a]:r}))}catch(N){console.error("Image compression failed:",N);const r=new FileReader;r.onloadend=()=>{c(i=>({...i,[a]:r.result}))},r.readAsDataURL(v)}},E=async a=>{if(window.confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{await d(a),(n==null?void 0:n.id)===a&&j(null)}catch(x){alert("Failed to delete customer: "+x.message)}},L=a=>{a.preventDefault();try{p(s),C(!1),c({name:"",email:"",phone:"",address:"",dob:"",dealerId:"",dlImage:"",aadhaarFront:"",aadhaarBack:""})}catch(x){alert(x.message)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsxs(g,{onClick:()=>C(!h),children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Add Customer"]})]}),e.jsx("div",{className:"flex items-center bg-muted/40 p-4 rounded-lg border",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute left-2.5 top-2.5 text-muted-foreground",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})}),e.jsx(t,{placeholder:"Search customers by name, phone, or email...",className:"pl-9 bg-background",value:S,onChange:a=>q(a.target.value)})]})}),h&&e.jsx(P,{className:"max-w-2xl",children:e.jsxs(B,{className:"pt-6",children:[e.jsx("div",{className:"text-lg font-semibold mb-4",children:"Add New Customer"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Customer Name",value:s.name,onChange:a=>c({...s,name:a.target.value}),required:!0}),e.jsx(t,{type:"email",placeholder:"Email",value:s.email,onChange:a=>c({...s,email:a.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Phone",value:s.phone,onChange:a=>c({...s,phone:a.target.value}),required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium ml-1",children:"Date of Birth"}),e.jsx(t,{type:"date",placeholder:"Date of Birth",value:s.dob,onChange:a=>c({...s,dob:a.target.value})})]}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:s.dealerId,onChange:a=>c({...s,dealerId:a.target.value}),children:[e.jsx("option",{value:"",children:"Select Dealer (Optional)"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsx(t,{placeholder:"Address",value:s.address,onChange:a=>c({...s,address:a.target.value})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>k("image",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"DL Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>k("dlImage",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Front"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>k("aadhaarFront",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Aadhaar Back"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>k("aadhaarBack",a),className:"cursor-pointer text-xs"})]})]})]}),e.jsx(g,{type:"submit",className:"w-full",children:"Save Customer"})]})]})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 items-start",children:R.map(a=>e.jsx(Z,{customer:a,onQuickView:()=>j(a)},a.id))}),e.jsx(M,{isOpen:!!n,onClose:()=>j(null),children:n&&(()=>{const a=y.filter(r=>r.customerId===n.id),x=a.filter(r=>r.paymentStatus!=="Paid").reduce((r,i)=>r+Math.max(0,(Number(i.total)||0)-(Number(i.amountPaid)||0)),0),v=[...a].sort((r,i)=>new Date(i.startDate)-new Date(r.startDate)).slice(0,3),N=w.find(r=>r.id===n.dealerId);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{className:"text-xl mb-1",children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.phone}),n.address&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.address}),a.length>0&&e.jsxs("p",{className:"text-xs bg-muted px-2 py-0.5 rounded w-fit mt-2",children:["ID: ",n.uniqueId||"N/A"]})]}),n.image&&e.jsx("div",{className:"h-16 w-16 rounded-full overflow-hidden border shrink-0 ml-4",children:e.jsx("img",{src:n.image,className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg cursor-pointer hover:bg-muted transition-colors border",onClick:()=>{j(null),D(n)},children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Pending Balance"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:`text-xl font-bold ${x>0?"text-destructive":""}`,children:["₹",x.toLocaleString()]}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Total Rentals"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-xl font-bold",children:a.length})})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-muted/20 p-2 rounded",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:["Referred by: ",e.jsx("span",{className:"font-medium text-foreground",children:N.name})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Recent Rentals"}),e.jsx("div",{className:"space-y-3",children:v.length>0?v.map(r=>{const i=l.find(T=>T.id===r.carId);return e.jsxs("div",{className:"flex justify-between items-center text-sm border-b pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i?`${i.make} ${i.model}`:"Unknown Car"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(r.startDate).toLocaleDateString()," • ₹",r.total]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.paymentStatus==="Paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.paymentStatus||"Pending"})]},r.id)}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No recent rentals"})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(g,{className:"flex-1",onClick:()=>{j(null),o("/customers/"+n.id)},children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," View Full Profile"]}),e.jsx(g,{variant:"outline",size:"icon",onClick:()=>{j(null),f(n)},children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(g,{variant:"destructive",size:"icon",onClick:()=>E(n.id),children:e.jsx(X,{className:"h-4 w-4"})})]})]})})()}),e.jsx(Y,{isOpen:!!b,onClose:()=>f(null),customer:b}),e.jsx(Q,{isOpen:!!I,onClose:()=>D(null),entity:I,transactions:y,type:"customer"})]})}export{xe as Customers};
