import{c as ne,h as ie,e as le,u as re,a as r,j as e,B as x,P as de,W as ce,S as oe,i as me,k as xe,I as p,l as ue}from"./index-CY3grNaN.js";import{C as g,a as y,b as w,c as v}from"./Card-BXQ70ezj.js";import{T as he,a as pe,b as D,c as k,A as je,E as fe}from"./EditMaintenanceDrawer-xIdgYDsN.js";import{E as ge}from"./EditCarDrawer-CYfccvbZ.js";import{T as O,E as ve}from"./EditTransactionDrawer-goZjf42a.js";import{S as C}from"./square-pen-DsQTHsOQ.js";import"./Table-ReX1Opzq.js";import"./react-pdf.browser-COupAn_t.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],A=ne("clock",be);function Se(){const{id:j}=ie(),V=le(),{cars:$,transactions:F,customers:T,addTransaction:q,updateCar:z,maintenanceRecords:I,deleteCar:B,deleteTransaction:H}=re(),[f,S]=r.useState("overview"),[L,b]=r.useState(!1),[W,R]=r.useState(!1),[_,P]=r.useState(!1),[U,Y]=r.useState(null),[G,E]=r.useState(!1),[J,K]=r.useState(null),[Q,M]=r.useState(!1),X=a=>{Y(a),E(!0)},Z=a=>{window.confirm("Are you sure you want to delete this rental record?")&&H(a)},[t,o]=r.useState({customerId:"",startDate:"",endDate:"",notes:"",paymentStatus:"Pending",dailyRate:"",mileage:""}),[u,ee]=r.useState({total:0,breakdown:[]}),s=$.find(a=>a.id===j),N=F.filter(a=>a.carId===j);if(r.useEffect(()=>{s&&o(a=>!a.dailyRate&&!a.mileage&&a.mileage!==0?{...a,dailyRate:s.price,mileage:s.mileage||""}:a)},[s]),r.useEffect(()=>{if(t.startDate&&t.endDate&&s){const a=new Date(t.startDate),i=new Date(t.endDate),d=Math.abs(i-a),n=Math.ceil(d/(1e3*60*60*24));let l=0,c=[];const h=t.dailyRate?parseFloat(t.dailyRate):s.price;if(n>0)if(n>=30&&s.monthlyPrice){const m=s.monthlyPrice/30;l=Math.round(m*n),c.push({label:`Monthly Rate Applied (${n} days @ ₹${Math.round(m)}/day)`,amount:l})}else if(n>=10&&s.tenDayPrice){const m=s.tenDayPrice/10;l=Math.round(m*n),c.push({label:`10-Day Rate Applied (${n} days @ ₹${Math.round(m)}/day)`,amount:l})}else l=Math.round(h*n),c.push({label:`Standard Daily Rate (${n} days @ ₹${h}/day)`,amount:l});ee({total:l,breakdown:c})}},[t.startDate,t.endDate,s,t.dailyRate]),!s)return e.jsx("div",{children:"Car not found"});const se=a=>{a.preventDefault();const i=new Date(t.startDate),d=new Date(t.endDate);if(N.some(c=>{if(c.status==="Cancelled")return!1;const h=new Date(c.startDate),m=new Date(c.endDate);return i>=h&&i<=m||d>=h&&d<=m||i<=h&&d>=m})){alert("This car is already rented for the selected dates!");return}console.log("Mileage check:",t.mileage),t.mileage!==""&&t.mileage!==null&&t.mileage!==void 0&&(console.log("Updating mileage to:",t.mileage),z(s.id,{mileage:parseInt(t.mileage)}));const l=[];t.paymentStatus==="Paid"&&l.push({id:ue(),date:new Date().toISOString().split("T")[0],amount:u.total,type:"Credit",medium:"Cash",notes:"Initial Payment"}),q({carId:s.id,customerId:t.customerId,startDate:t.startDate,endDate:t.endDate,total:u.total,status:"Active",paymentStatus:t.paymentStatus,notes:t.notes,breakdown:u.breakdown,dailyRate:t.dailyRate,payments:l,amountPaid:t.paymentStatus==="Paid"?u.total:0,startMileage:t.mileage}),b(!1),o({customerId:"",startDate:"",endDate:"",notes:"",paymentStatus:"Pending",dailyRate:"",mileage:""}),S("rentals")},ae=()=>{window.confirm("Are you sure you want to delete this car? This action cannot be undone.")&&(B(s.id),V("/cars"))},te=()=>{if(!s.insuranceValidTo)return null;const a=new Date,d=new Date(s.insuranceValidTo)-a,n=Math.ceil(d/(1e3*60*60*24));return n<=3&&n>=0?e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg mb-6 flex items-center gap-3 text-destructive",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Insurance Expiring Soon!"}),e.jsxs("p",{className:"text-sm",children:["Insurance is valid only for ",n," more day",n!==1?"s":"",". Please renew immediately."]})]})]}):n<0?e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg mb-6 flex items-center gap-3 text-destructive",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Insurance Expired!"}),e.jsxs("p",{className:"text-sm",children:["Insurance expired on ",s.insuranceValidTo,". Do not rent this car until renewed."]})]})]}):null};return e.jsxs("div",{className:"space-y-8 relative",children:[te(),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-4xl font-bold mb-2",children:[s.make," ",s.model]}),e.jsxs("p",{className:"text-xl text-muted-foreground",children:[s.year," • ",s.plateNumber]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-muted-foreground",children:[s.color&&e.jsxs("span",{children:["Color: ",s.color]}),s.fuelType&&e.jsxs("span",{children:["Fuel: ",s.fuelType]}),e.jsxs("span",{children:["Mileage: ",s.mileage," km"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>R(!0),children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," Edit"]}),e.jsxs(x,{variant:"destructive",onClick:ae,children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Delete"]}),e.jsxs(x,{onClick:()=>b(!0),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Rent Car"]})]})]}),e.jsxs(he,{value:f,onValueChange:S,children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 mb-6",children:e.jsxs(pe,{className:"bg-transparent p-0",children:[e.jsx(D,{value:"overview",className:`rounded-none border-b-2 px-6 py-3 ${f==="overview"?"border-primary text-primary":"border-transparent"}`,children:"Overview"}),e.jsx(D,{value:"rentals",className:`rounded-none border-b-2 px-6 py-3 ${f==="rentals"?"border-primary text-primary":"border-transparent"}`,children:"Rentals"}),e.jsx(D,{value:"maintenance",className:`rounded-none border-b-2 px-6 py-3 ${f==="maintenance"?"border-primary text-primary":"border-transparent"}`,children:"Maintenance"})]})}),e.jsx(k,{value:"overview",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"aspect-video w-full overflow-hidden rounded-lg bg-muted",children:s.image?e.jsx("img",{src:s.image,alt:`${s.make} ${s.model}`,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No Image"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.rcImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(s.rcImage),children:[e.jsx("img",{src:s.rcImage,alt:"RC",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View RC"})]}),s.insuranceImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(s.insuranceImage),children:[e.jsx("img",{src:s.insuranceImage,alt:"Insurance",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View Insurance"})]}),s.pocImage&&e.jsxs("div",{className:"aspect-video rounded bg-muted overflow-hidden relative group cursor-pointer",onClick:()=>window.open(s.pocImage),children:[e.jsx("img",{src:s.pocImage,alt:"POC",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View POC"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status==="Available"?"bg-green-100 text-green-800":s.status==="On Rent"?"bg-blue-100 text-blue-800":s.status==="On Maintenance"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:s.status})}),e.jsxs(g,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(w,{className:"text-base",children:"Vehicle Specifications"})}),e.jsxs(v,{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Mileage"}),e.jsxs("span",{className:"font-medium text-lg",children:[s.mileage," km"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Fuel Type"}),e.jsx("span",{className:"font-medium",children:s.fuelType||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Color"}),e.jsx("span",{className:"font-medium",children:s.color||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Year"}),e.jsx("span",{className:"font-medium",children:s.year})]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),(s.fitnessValidTo||s.taxValidTo||s.insuranceValidTo)&&e.jsxs(g,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(w,{className:"text-base",children:"Validity"})}),e.jsxs(v,{className:"grid grid-cols-2 gap-4 text-sm",children:[s.fitnessValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Fitness"}),e.jsx("span",{className:"font-medium",children:s.fitnessValidTo})]}),s.taxValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Tax"}),e.jsx("span",{className:"font-medium",children:s.taxValidTo})]}),s.insuranceValidTo&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Insurance"}),e.jsx("span",{className:"font-medium",children:s.insuranceValidTo})]})]})]}),e.jsxs(g,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(w,{className:"text-base",children:"Pricing"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Daily Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",s.price]})]}),s.tenDayPrice&&e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"10 Days Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",s.tenDayPrice]})]}),s.monthlyPrice&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly Rate"}),e.jsxs("span",{className:"font-bold text-xl",children:["₹",s.monthlyPrice]})]})]})]})]})]})}),e.jsx(k,{value:"rentals",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-2xl font-bold",children:"Rental History"})}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 bg-muted/50 font-medium text-sm",children:[e.jsx("div",{className:"col-span-2",children:"Customer"}),e.jsx("div",{children:"Dates"}),e.jsx("div",{children:"Amount"}),e.jsx("div",{children:"Balance"}),e.jsx("div",{className:"text-right",children:"Actions"})]}),e.jsxs("div",{className:"divide-y",children:[N.map(a=>{const i=T.find(c=>c.id===a.customerId),d=Number(a.total)||0,n=Number(a.amountPaid)||0,l=d-n;return e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 items-center text-sm hover:bg-muted/20 transition-colors",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"font-medium",children:i==null?void 0:i.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i==null?void 0:i.phone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.startDate}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["to ",a.endDate]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["₹",d]}),e.jsx("div",{className:`text-xs ${a.paymentStatus==="Paid"?"text-green-600":"text-orange-600"}`,children:a.paymentStatus})]}),e.jsx("div",{children:e.jsxs("div",{className:`font-medium ${l>0?"text-destructive":"text-green-600"}`,children:["₹",l]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>{K(a),M(!0)},children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>Z(a.id),children:e.jsx(O,{className:"h-4 w-4"})})]})]},a.id)}),N.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No rental history found."})]})]})]})}),e.jsx(k,{value:"maintenance",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Maintenance History"}),e.jsxs(x,{onClick:()=>P(!0),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Add Record"]})]}),e.jsx("div",{className:"grid gap-4",children:I.filter(a=>a.carId===j).length>0?I.filter(a=>a.carId===j).map(a=>e.jsx(g,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-bold text-lg",children:a.workshopName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:a.date}),a.returnDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" - "}),e.jsx("span",{children:a.returnDate})]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:a.workshopDetails})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[e.jsxs("p",{className:"font-bold text-xl",children:["₹",a.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>X(a),children:e.jsx(C,{className:"h-4 w-4"})}),a.image&&e.jsx(x,{variant:"link",size:"sm",className:"h-auto p-0 text-xs",onClick:()=>{window.open().document.write('<img src="'+a.image+'" style="max-width:100%;"/>')},children:"Receipt"})]})]})]})})},a.id)):e.jsx("div",{className:"text-center py-12 text-muted-foreground bg-surface rounded-lg",children:"No maintenance records found for this car."})})]})})]}),e.jsx(je,{isOpen:_,onClose:()=>P(!1),carId:s.id}),e.jsx(fe,{isOpen:G,onClose:()=>E(!1),record:U}),e.jsxs(oe,{isOpen:L,onClose:()=>b(!1),children:[e.jsx(me,{children:e.jsxs(xe,{children:["Rent ",s.make," ",s.model]})}),e.jsx("div",{className:"mt-6",children:e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Customer"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:t.customerId,onChange:a=>o({...t,customerId:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),T.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsx(p,{type:"date",value:t.startDate,onChange:a=>o({...t,startDate:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsx(p,{type:"date",value:t.endDate,onChange:a=>o({...t,endDate:a.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Per Day Amount"}),e.jsx(p,{type:"number",value:t.dailyRate,onChange:a=>o({...t,dailyRate:a.target.value}),placeholder:"Enter daily rate"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Mileage"}),e.jsx(p,{type:"number",value:t.mileage,onChange:a=>o({...t,mileage:a.target.value}),placeholder:"Starting mileage"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Payment Status"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-surface-dark dark:text-text-dark dark:border-surface",value:t.paymentStatus,onChange:a=>o({...t,paymentStatus:a.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Pay on Arrival",children:"Pay on Arrival"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(p,{placeholder:"Additional notes...",value:t.notes,onChange:a=>o({...t,notes:a.target.value})})]}),e.jsxs("div",{className:"bg-surface dark:bg-surface-dark p-4 rounded-lg space-y-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("span",{className:"text-sm font-medium",children:"Price Breakdown"})}),u.breakdown.length>0?e.jsxs("div",{className:"space-y-1",children:[u.breakdown.map((a,i)=>e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:a.label}),e.jsxs("span",{children:["₹",a.amount]})]},i)),e.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between text-sm font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",u.total]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select dates to see price breakdown."})]}),e.jsx(x,{type:"submit",className:"w-full",children:"Confirm Rental"})]})})]}),e.jsx(ve,{isOpen:Q,onClose:()=>M(!1),transaction:J}),e.jsx(ge,{isOpen:W,onClose:()=>R(!1),car:s})]})}export{Se as CarDetails};
