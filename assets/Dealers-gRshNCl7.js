import{u as D,a as h,j as e,S as R,k as T,l as q,I as t,B as u,f as U,P as F,U as z}from"./index-BwtqAUt7.js";import{C as S,b as B,a as A}from"./Card-aWMVJlsh.js";import{P as O,C as H}from"./PendingTransactionsDrawer-CnAxnfnp.js";import{a as Q,b as V}from"./EditTransactionDrawer-0jkdp8E_.js";import{A as $}from"./arrow-up-right-DQYGrcTn.js";import{S as M}from"./square-pen-6zai-Pt3.js";import{T as W}from"./trash-2-BunDUYmv.js";import{U as G}from"./user-DTuM9DXv.js";import"./Table-D_po6nZo.js";import"./react-pdf.browser-Bu-Ac-AW.js";import"./lock-B9OlmGNY.js";function J({isOpen:d,onClose:g,dealer:n}){const{updateDealer:y}=D(),[l,o]=h.useState({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""});h.useEffect(()=>{n&&o({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",contactPerson:n.contactPerson||"",pan:n.pan||"",image:n.image||"",logo:n.logo||"",shopAct:n.shopAct||"",panImage:n.panImage||"",proof:n.proof||"",altProof:n.altProof||""})},[n]);const m=(a,w)=>{const v=w.target.files[0];if(v){const p=new FileReader;p.onloadend=()=>{o(C=>({...C,[a]:p.result}))},p.readAsDataURL(v)}},c=a=>{a.preventDefault(),y(n.id,l),g()};return e.jsxs(R,{isOpen:d,onClose:g,children:[e.jsx(T,{children:e.jsx(q,{children:"Edit Dealer"})}),e.jsx("div",{className:"mt-6 h-[calc(100vh-10rem)] overflow-y-auto pr-4",children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Dealer Name",value:l.name,onChange:a=>o({...l,name:a.target.value}),required:!0}),e.jsx(t,{placeholder:"Unique ID (e.g. DLR001)",value:l.uniqueId,onChange:a=>o({...l,uniqueId:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{type:"email",placeholder:"Email",value:l.email,onChange:a=>o({...l,email:a.target.value}),required:!0}),e.jsx(t,{placeholder:"Phone",value:l.phone,onChange:a=>o({...l,phone:a.target.value}),required:!0})]}),e.jsx(t,{placeholder:"Contact Person Name",value:l.contactPerson,onChange:a=>o({...l,contactPerson:a.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"PAN Number"}),e.jsx(t,{value:l.pan,onChange:a=>o({...l,pan:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Address"}),e.jsx(t,{value:l.address,onChange:a=>o({...l,address:a.target.value})})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("image",a),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Logo"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("logo",a),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("proof",a),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Alt Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("altProof",a),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Shop Act"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("shopAct",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"PAN Card Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>m("panImage",a),className:"cursor-pointer text-xs"})]})]})]}),l.image&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:l.image,alt:"Preview",className:"w-20 h-20 object-cover rounded-full border-2 border-primary"})}),e.jsx(u,{type:"submit",className:"w-full",children:"Save Changes"})]})})]})}function K({dealer:d,onQuickView:g}){return e.jsx(S,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-lg border-l-4 border-l-secondary/20 hover:border-l-secondary cursor-pointer",onClick:g,children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-secondary/10 flex items-center justify-center flex-shrink-0 overflow-hidden",children:d.image?e.jsx("img",{src:d.image,alt:d.name,className:"h-full w-full object-cover"}):e.jsx(G,{className:"h-6 w-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.phone})]})]}),e.jsx(u,{variant:"ghost",size:"icon",className:"text-muted-foreground",children:e.jsx(H,{className:"h-5 w-5"})})]})})})}function ie(){const{dealers:d,addDealer:g,deleteDealer:n,transactions:y}=D(),l=U(),[o,m]=h.useState(!1),[c,a]=h.useState({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""}),[w,v]=h.useState(null),[p,C]=h.useState(null),[i,j]=h.useState(null),[P,I]=h.useState(""),k=d.filter(s=>(s.name+" "+s.phone+" "+s.email).toLowerCase().includes(P.toLowerCase())),f=(s,x)=>{const b=x.target.files[0];if(b){const r=new FileReader;r.onloadend=()=>{a(N=>({...N,[s]:r.result}))},r.readAsDataURL(b)}},L=async s=>{if(window.confirm("Are you sure you want to delete this dealer? This action cannot be undone."))try{await n(s),(i==null?void 0:i.id)===s&&j(null)}catch(x){alert("Failed to delete dealer: "+x.message)}},E=s=>{s.preventDefault();try{g(c),m(!1),a({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""})}catch(x){alert(x.message)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dealers"}),e.jsxs(u,{onClick:()=>m(!o),children:[e.jsx(F,{className:"mr-2 h-4 w-4"})," Add Dealer"]})]}),e.jsx("div",{className:"flex items-center bg-muted/40 p-4 rounded-lg border",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute left-2.5 top-2.5 text-muted-foreground",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})}),e.jsx(t,{placeholder:"Search dealers by name, phone, or email...",className:"pl-9 bg-background",value:P,onChange:s=>I(s.target.value)})]})}),o&&e.jsxs(S,{className:"max-w-2xl",children:[e.jsx(B,{children:e.jsx("div",{className:"text-lg font-semibold",children:"Add New Dealer"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Dealer Name",value:c.name,onChange:s=>a({...c,name:s.target.value}),required:!0}),e.jsx(t,{placeholder:"Contact Person Name",value:c.contactPerson,onChange:s=>a({...c,contactPerson:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{type:"email",placeholder:"Email",value:c.email,onChange:s=>a({...c,email:s.target.value}),required:!0}),e.jsx(t,{placeholder:"Phone",value:c.phone,onChange:s=>a({...c,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"PAN Number",value:c.pan,onChange:s=>a({...c,pan:s.target.value})}),e.jsx(t,{placeholder:"Address",value:c.address,onChange:s=>a({...c,address:s.target.value})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("image",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Logo"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("logo",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("proof",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Alt Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("altProof",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Shop Act"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("shopAct",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"PAN Card Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>f("panImage",s),className:"cursor-pointer text-xs"})]})]})]}),e.jsx(u,{type:"submit",className:"w-full",children:"Save Dealer"})]})})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 items-start",children:k.map(s=>e.jsx(K,{dealer:s,onQuickView:()=>j(s)},s.id))}),e.jsx(Q,{isOpen:!!i,onClose:()=>j(null),children:i&&(()=>{const s=y.filter(r=>r.dealerId===i.id),x=s.filter(r=>r.paymentStatus!=="Paid").reduce((r,N)=>r+Math.max(0,(Number(N.total)||0)-(Number(N.amountPaid)||0)),0),b=[...s].sort((r,N)=>new Date(N.startDate)-new Date(r.startDate)).slice(0,3);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{className:"text-xl mb-1",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.phone}),i.address&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i.address})]}),i.image&&e.jsx("div",{className:"h-16 w-16 rounded-full overflow-hidden border shrink-0 ml-4",children:e.jsx("img",{src:i.image,className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg cursor-pointer hover:bg-muted transition-colors border",onClick:()=>{j(null),C(i)},children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Pending Collection"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:`text-xl font-bold ${x>0?"text-destructive":""}`,children:["₹",x.toLocaleString()]}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Lifetime Rentals"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-xl font-bold",children:s.length})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:b.length>0?b.map(r=>e.jsxs("div",{className:"flex justify-between items-center text-sm border-b pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:new Date(r.startDate).toLocaleDateString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["₹",r.total," • ",r.paymentStatus||"Pending"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.paymentStatus==="Paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.paymentStatus||"Pending"})]},r.id)):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No recent activity"})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(u,{className:"flex-1",onClick:()=>{j(null),l("/dealers/"+i.id)},children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," View Full Profile"]}),e.jsx(u,{variant:"outline",size:"icon",onClick:()=>{j(null),v(i)},children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(u,{variant:"destructive",size:"icon",onClick:()=>L(i.id),children:e.jsx(W,{className:"h-4 w-4"})})]})]})})()}),e.jsx(J,{isOpen:!!w,onClose:()=>v(null),dealer:w}),e.jsx(O,{isOpen:!!p,onClose:()=>C(null),entity:p,transactions:y,type:"dealer"})]})}export{ie as Dealers};
