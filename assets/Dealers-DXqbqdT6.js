import{u as P,a as h,j as e,S as k,i as E,k as R,I as t,B as u,e as q,P as L,U as T}from"./index-gxGV3Q_W.js";import{C as D,c as A}from"./Card-CzXmBwuc.js";import{P as U,C as F}from"./PendingTransactionsDrawer-DQT7MC-S.js";import{D as z,a as O}from"./Dialog-ElIb6C4p.js";import{A as B}from"./arrow-up-right-DsOB766c.js";import{S as H}from"./square-pen-UbYTflp1.js";import{T as Q}from"./trash-2-DWU8ExzB.js";import{U as V}from"./user-CEBFMmOL.js";import"./EditTransactionDrawer-CGRAftJb.js";import"./Table-D6RVhYMa.js";function $({isOpen:d,onClose:g,dealer:n}){const{updateDealer:b}=P(),[l,o]=h.useState({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""});h.useEffect(()=>{n&&o({name:n.name||"",email:n.email||"",phone:n.phone||"",address:n.address||"",contactPerson:n.contactPerson||"",pan:n.pan||"",image:n.image||"",logo:n.logo||"",shopAct:n.shopAct||"",panImage:n.panImage||"",proof:n.proof||"",altProof:n.altProof||""})},[n]);const m=(s,C)=>{const v=C.target.files[0];if(v){const p=new FileReader;p.onloadend=()=>{o(w=>({...w,[s]:p.result}))},p.readAsDataURL(v)}},c=s=>{s.preventDefault(),b(n.id,l),g()};return e.jsxs(k,{isOpen:d,onClose:g,children:[e.jsx(E,{children:e.jsx(R,{children:"Edit Dealer"})}),e.jsx("div",{className:"mt-6 h-[calc(100vh-10rem)] overflow-y-auto pr-4",children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Dealer Name",value:l.name,onChange:s=>o({...l,name:s.target.value}),required:!0}),e.jsx(t,{placeholder:"Unique ID (e.g. DLR001)",value:l.uniqueId,onChange:s=>o({...l,uniqueId:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{type:"email",placeholder:"Email",value:l.email,onChange:s=>o({...l,email:s.target.value}),required:!0}),e.jsx(t,{placeholder:"Phone",value:l.phone,onChange:s=>o({...l,phone:s.target.value}),required:!0})]}),e.jsx(t,{placeholder:"Contact Person Name",value:l.contactPerson,onChange:s=>o({...l,contactPerson:s.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"PAN Number"}),e.jsx(t,{value:l.pan,onChange:s=>o({...l,pan:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Address"}),e.jsx(t,{value:l.address,onChange:s=>o({...l,address:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("image",s),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Logo"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("logo",s),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("proof",s),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Alt Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("altProof",s),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Shop Act"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("shopAct",s),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"PAN Card Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:s=>m("panImage",s),className:"cursor-pointer text-xs"})]})]})]}),l.image&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:l.image,alt:"Preview",className:"w-20 h-20 object-cover rounded-full border-2 border-primary"})}),e.jsx(u,{type:"submit",className:"w-full",children:"Save Changes"})]})})]})}function M({dealer:d,onQuickView:g}){return e.jsx(D,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-lg border-l-4 border-l-secondary/20 hover:border-l-secondary cursor-pointer",onClick:g,children:e.jsx(A,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-secondary/10 flex items-center justify-center flex-shrink-0 overflow-hidden",children:d.image?e.jsx("img",{src:d.image,alt:d.name,className:"h-full w-full object-cover"}):e.jsx(V,{className:"h-6 w-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.phone})]})]}),e.jsx(u,{variant:"ghost",size:"icon",className:"text-muted-foreground",children:e.jsx(F,{className:"h-5 w-5"})})]})})})}function ae(){const{dealers:d,addDealer:g,deleteDealer:n,transactions:b}=P(),l=q(),[o,m]=h.useState(!1),[c,s]=h.useState({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""}),[C,v]=h.useState(null),[p,w]=h.useState(null),[i,j]=h.useState(null),f=(a,x)=>{const y=x.target.files[0];if(y){const r=new FileReader;r.onloadend=()=>{s(N=>({...N,[a]:r.result}))},r.readAsDataURL(y)}},S=async a=>{if(window.confirm("Are you sure you want to delete this dealer? This action cannot be undone."))try{await n(a),(i==null?void 0:i.id)===a&&j(null)}catch(x){alert("Failed to delete dealer: "+x.message)}},I=a=>{a.preventDefault();try{g(c),m(!1),s({name:"",email:"",phone:"",address:"",contactPerson:"",pan:"",image:"",logo:"",shopAct:"",panImage:"",proof:"",altProof:""})}catch(x){alert(x.message)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dealers"}),e.jsxs(u,{onClick:()=>m(!o),children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Add Dealer"]})]}),o&&e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(CardHeader,{children:e.jsx("div",{className:"text-lg font-semibold",children:"Add New Dealer"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"Dealer Name",value:c.name,onChange:a=>s({...c,name:a.target.value}),required:!0}),e.jsx(t,{placeholder:"Contact Person Name",value:c.contactPerson,onChange:a=>s({...c,contactPerson:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{type:"email",placeholder:"Email",value:c.email,onChange:a=>s({...c,email:a.target.value}),required:!0}),e.jsx(t,{placeholder:"Phone",value:c.phone,onChange:a=>s({...c,phone:a.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(t,{placeholder:"PAN Number",value:c.pan,onChange:a=>s({...c,pan:a.target.value})}),e.jsx(t,{placeholder:"Address",value:c.address,onChange:a=>s({...c,address:a.target.value})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Documents & Images"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Profile Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("image",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Logo"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("logo",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("proof",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Alt Proof"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("altProof",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"Shop Act"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("shopAct",a),className:"cursor-pointer text-xs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"PAN Card Image"}),e.jsx(t,{type:"file",accept:"image/*",onChange:a=>f("panImage",a),className:"cursor-pointer text-xs"})]})]})]}),e.jsx(u,{type:"submit",className:"w-full",children:"Save Dealer"})]})})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 items-start",children:d.map(a=>e.jsx(M,{dealer:a,onQuickView:()=>j(a)},a.id))}),e.jsx(z,{isOpen:!!i,onClose:()=>j(null),children:i&&(()=>{const a=b.filter(r=>r.dealerId===i.id),x=a.filter(r=>r.paymentStatus!=="Paid").reduce((r,N)=>r+Math.max(0,(Number(N.total)||0)-(Number(N.amountPaid)||0)),0),y=[...a].sort((r,N)=>new Date(N.startDate)-new Date(r.startDate)).slice(0,3);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-xl mb-1",children:i.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.phone}),i.address&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i.address})]}),i.image&&e.jsx("div",{className:"h-16 w-16 rounded-full overflow-hidden border shrink-0 ml-4",children:e.jsx("img",{src:i.image,className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg cursor-pointer hover:bg-muted transition-colors border",onClick:()=>{j(null),w(i)},children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Pending Collection"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:`text-xl font-bold ${x>0?"text-destructive":""}`,children:["₹",x.toLocaleString()]}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]})]}),e.jsxs("div",{className:"p-4 bg-muted/40 rounded-lg border",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Lifetime Rentals"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("p",{className:"text-xl font-bold",children:a.length})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:y.length>0?y.map(r=>e.jsxs("div",{className:"flex justify-between items-center text-sm border-b pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:new Date(r.startDate).toLocaleDateString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["₹",r.total," • ",r.paymentStatus||"Pending"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.paymentStatus==="Paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.paymentStatus||"Pending"})]},r.id)):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No recent activity"})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(u,{className:"flex-1",onClick:()=>{j(null),l("/dealers/"+i.id)},children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," View Full Profile"]}),e.jsx(u,{variant:"outline",size:"icon",onClick:()=>{j(null),v(i)},children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(u,{variant:"destructive",size:"icon",onClick:()=>S(i.id),children:e.jsx(Q,{className:"h-4 w-4"})})]})]})})()}),e.jsx($,{isOpen:!!C,onClose:()=>v(null),dealer:C}),e.jsx(U,{isOpen:!!p,onClose:()=>w(null),entity:p,transactions:b,type:"dealer"})]})}export{ae as Dealers};
